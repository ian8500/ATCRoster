{% extends "base.html" %}
{% block title %}OT/Swap/EXT Totals{% endblock %}

{% block content %}
<div class="container">
  <h1 class="page-title">OT/Swap/EXT Totals</h1>

  <p class="muted" style="margin-top:-.5rem">
    Counts are based on the <strong>annotation definitions</strong> configured in Admin → Reference Data.
    “AAVA Total” adds all overtime annotations tagged with <code>aava</code>; “OT Total” includes every annotation tagged with <code>ot</code>.
  </p>

  <form method="get" class="bar">
    <label for="start">From</label>
    <input id="start" name="start" type="date" value="{{ start.isoformat() }}">
    <label for="end">To</label>
    <input id="end" name="end" type="date" value="{{ end.isoformat() }}">
    <button class="btn btn-primary" type="submit">Update</button>
    <a class="btn" href="{{ url_for('metrics_export', start=start.isoformat(), end=end.isoformat()) }}">Download CSV</a>
  </form>

  <div class="card">
    <div class="card-body">
      <table class="table">
        <thead>
          <tr>
            <th>ATCO</th>
            <th>Watch</th>
            <th>Ext L</th>
            <th>Ext S</th>
            <th>Ext Total</th>
            <th>Swaps</th>
            {% for col in ot_columns %}
              <th>{{ col.label }}</th>
            {% endfor %}
            <th>AAVA Total</th>
            <th>OT Total</th>
          </tr>
        </thead>
        <tbody>
          {% for r in staff_metrics %}
          <tr>
            <td>{{ r.staff.name }}</td>
            <td>{{ r.staff.watch.name.replace('Watch ','') if r.staff.watch else '-' }}</td>
            <td>{{ r.ext_long }}</td>
            <td>{{ r.ext_short }}</td>
            <td>{{ r.ext_total }}</td>
            <td>{{ r.swaps }}</td>
            {% for col in ot_columns %}
              <td>{{ r.ot[col.code] }}</td>
            {% endfor %}
            <td>{{ r.aava_total }}</td>
            <td>{{ r.ot_total }}</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr class="strong">
            <td>All ATCOs</td>
            <td></td>
            <td>{{ totals.ext_long }}</td>
            <td>{{ totals.ext_short }}</td>
            <td>{{ totals.ext_total }}</td>
            <td>{{ totals.swaps }}</td>
            {% for col in ot_columns %}
              <td>{{ totals.ot[col.code] }}</td>
            {% endfor %}
            <td>{{ totals.aava_total }}</td>
            <td>{{ totals.ot_total }}</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
{% endblock %}
