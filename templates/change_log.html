{% extends "base.html" %}
{% block title %}Change Log{% endblock %}

{% block content %}
<div class="stack">
  <header class="stack">
    <h1 class="page-title">Change Log</h1>
    <p class="muted">Audit every roster adjustment, leave update, and admin action in one consistent view.</p>
  </header>

  <div class="card">
    <div class="card-hd"><i class="fa-solid fa-filter"></i> Filter entries</div>
    <div class="card-bd">
      <form method="get" class="row g-3 align-items-end">
        <div class="col-sm-6 col-lg-3">
          <label class="form-label" for="change-log-month">Month (YYYY-MM)</label>
          <input class="form-control" id="change-log-month" type="text" name="ym" value="{{ ym or '' }}" autocomplete="off" placeholder="2024-08">
        </div>
        <div class="col-sm-6 col-lg-3">
          <label class="form-label" for="change-log-entity">Entity type</label>
          <input class="form-control" id="change-log-entity" type="text" name="entity_type" value="{{ entity_type or '' }}" placeholder="shift, leave…">
        </div>
        <div class="col-sm-6 col-lg-3">
          <label class="form-label" for="change-log-user">User ID</label>
          <input class="form-control" id="change-log-user" type="text" name="who" value="{{ who or '' }}" placeholder="123">
        </div>
        <div class="col-auto">
          <button class="btn btn-primary" type="submit"><i class="fa-solid fa-search"></i> Apply filters</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-hd"><i class="fa-solid fa-clock-rotate-left"></i> Recent changes</div>
    <div class="card-bd">
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th scope="col">When (UTC)</th>
              <th scope="col">User</th>
              <th scope="col">Entity</th>
              <th scope="col">Field</th>
              <th scope="col">Old → New</th>
              <th scope="col">Month</th>
              <th scope="col">Note</th>
            </tr>
          </thead>
          <tbody>
            {% if rows %}
              {% for r in rows %}
                <tr>
                  <td>{{ r.when }}</td>
                  <td>{{ r.who_user_id }}</td>
                  <td>{{ r.entity_type }} #{{ r.entity_id }}</td>
                  <td>{{ r.field }}</td>
                  <td><code>{{ r.old_value }}</code> → <code>{{ r.new_value }}</code></td>
                  <td>{{ r.context_month }}</td>
                  <td>{{ r.note }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="7" class="text-center text-muted py-4">No results for the selected filters.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
