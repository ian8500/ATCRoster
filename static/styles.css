/* ==============================
   ATC Roster — Dark Theme CSS
   ============================== */
:root{
  --bg:#0f1727;
  --bg-alt:#0b1220;
  --card:#162037;
  --card-elevated:#1f2b47;
  --line:rgba(99,115,138,.35);
  --line-strong:rgba(127,146,176,.55);
  --text:#ecf1fa;
  --text-muted:#9aa6be;
  --head:#1c2946;
  --head2:#223152;
  --accent:#69a7ff;
  --accent-strong:#3d7dff;
  --accent-soft:rgba(61,125,255,.18);
  --shadow-soft:0 32px 70px -40px rgba(8,18,38,.9);
  --shadow-pop:0 24px 65px -30px rgba(35,64,120,.65);
  --radius-lg:18px;
  --radius-md:12px;
  --radius-sm:8px;
  --font-sans:"Inter", "Segoe UI", "SF Pro Display", -apple-system, BlinkMacSystemFont, "Roboto", sans-serif;
  --font-mono:"JetBrains Mono", "Fira Code", "SFMono-Regular", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

  --green:#27ae60;   /* M* */
  --purple:#8e44ad;  /* D* */
  --orange:#e67e22;  /* A* */
  --yellow:#f1c40f;  /* N* */

  --red:#e74c3c;     /* SSC, SC */
  --blue:#3498db;    /* AL, PL, SPL, TOUI, TOU8 */

  --ui-scale: 1;     /* dynamic scaling for roster */
}

*{box-sizing:border-box}

::selection{background:var(--accent-strong); color:#fff;}

/* Office/WFH/MTG: grey fill */
.code-input.office, .code-input.wfh, .code-input.mtg {
  background: #666 !important;
  color: #fff !important;
}

/* ==============================
   Global
   ============================== */
body{
  font-family:var(--font-sans);
  margin:0;
  padding:0;
  min-height:100vh;
  color:var(--text);
  background:radial-gradient(circle at 20% 20%, rgba(70,105,255,.18), transparent 55%),
             radial-gradient(circle at 80% 0%, rgba(18,201,255,.12), transparent 45%),
             var(--bg);
  position:relative;
  line-height:1.6;
  letter-spacing:.01em;
}

body::before{
  content:"";
  position:fixed;
  inset:0;
  background:linear-gradient(135deg, rgba(21,29,46,.65), transparent 55%);
  pointer-events:none;
  z-index:-1;
}

h1,h2,h3{
  margin:.25rem 0 1.1rem;
  color:#fff;
  letter-spacing:.02em;
}

h1{font-size: clamp(1.75rem, 1.4rem + 1vw, 2.4rem); font-weight:700;}
h2{font-size: clamp(1.3rem, 1.15rem + .6vw, 1.9rem); font-weight:600;}
h3{font-size: clamp(1.15rem, 1rem + .4vw, 1.5rem); font-weight:600; color:var(--text);}

p{color:var(--text-muted); margin:0 0 1rem;}

a{
  color:var(--accent);
  text-decoration:none;
  transition:color .2s ease;
}

a:hover,
a:focus-visible{color:var(--accent-strong);}

.btn,
a.btn,
button{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:.4rem;
  padding:.45rem .95rem;
  margin:.1rem;
  border-radius:var(--radius-sm);
  border:1px solid rgba(111,139,190,.35);
  background:linear-gradient(135deg, rgba(110,140,255,.08), rgba(28,44,80,.85));
  color:var(--text);
  font-size:.92rem;
  font-weight:600;
  letter-spacing:.01em;
  text-shadow:0 1px 1px rgba(8,12,22,.6);
  box-shadow:0 8px 18px -12px rgba(33,59,122,.9);
  transition:transform .18s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
  font-family:var(--font-sans);
  cursor:pointer;
}

.btn:hover,
a.btn:hover,
button:hover{
  transform:translateY(-1px);
  box-shadow:0 18px 26px -20px rgba(61,125,255,.65);
  border-color:rgba(129,164,232,.55);
  background:linear-gradient(135deg, rgba(110,140,255,.18), rgba(28,44,80,.92));
}

.btn:disabled,
a.btn.disabled,
button:disabled{
  opacity:.55;
  cursor:not-allowed;
  transform:none;
  box-shadow:none;
}

.btn:focus-visible,
a.btn:focus-visible,
button:focus-visible{
  outline:2px solid var(--accent-strong);
  outline-offset:3px;
}

a.btn.ghost{
  background:rgba(14,23,38,.35);
  border-color:rgba(99,115,138,.4);
  box-shadow:none;
}

code{
  font-family:var(--font-mono);
  background:rgba(18,24,40,.7);
  padding:.15rem .35rem;
  border-radius:6px;
  border:1px solid rgba(98,122,164,.3);
  color:var(--accent);
}

.page-content{
  width:min(100%, 1800px);
  margin:0 auto;
  padding:clamp(1.5rem, 1rem + 2vw, 3.5rem) clamp(1.2rem, 3vw, 4rem);
  display:flex;
  flex-direction:column;
  gap:1.5rem;
  min-height:calc(100vh - 72px);
}

section,
.content-surface{
  background:linear-gradient(145deg, rgba(24,33,53,.82), rgba(14,22,38,.82));
  border-radius:var(--radius-lg);
  border:1px solid rgba(101,126,173,.22);
  box-shadow:var(--shadow-soft);
  padding:1.5rem;
}

.month-nav{
  display:flex;
  align-items:center;
  flex-wrap:wrap;
  gap:.75rem;
  background:linear-gradient(135deg, rgba(25,35,56,.82), rgba(18,28,48,.82));
  border-radius:var(--radius-lg);
  border:1px solid rgba(94,121,170,.25);
  padding:.85rem 1.15rem;
  box-shadow:var(--shadow-soft);
}

.month-nav a{font-weight:600;}

.month-nav strong{letter-spacing:.05em; font-size:1.05rem; color:#fff;}

form{
  display:grid;
  gap:1rem;
}

label{
  font-size:.85rem;
  letter-spacing:.02em;
  text-transform:uppercase;
  color:var(--text-muted);
  font-weight:600;
}

input,
select,
textarea{
  font-family:var(--font-sans);
  font-size:.95rem;
  padding:.55rem .75rem;
  border-radius:var(--radius-sm);
  border:1px solid rgba(116,138,178,.35);
  background:rgba(13,22,38,.65);
  color:var(--text);
  transition:border-color .2s ease, box-shadow .2s ease, background .2s ease;
}

input::placeholder,
textarea::placeholder{
  color:rgba(156,173,205,.75);
}

input:focus,
select:focus,
textarea:focus{
  outline:none;
  border-color:rgba(108,148,228,.75);
  box-shadow:0 0 0 3px rgba(79,125,255,.18);
  background:rgba(19,31,52,.85);
}

textarea{min-height:140px; resize:vertical;}

/* ==============================
   Header & Navigation
   ============================== */
.site-header {
  background:rgba(12,20,35,.7);
  border-bottom:1px solid rgba(108,129,168,.25);
  padding:.85rem clamp(1.2rem, 3vw, 2.6rem);
  position:sticky;
  top:0;
  z-index:1000;
  box-shadow:0 14px 42px -32px rgba(7,17,34,.9);
  backdrop-filter:blur(18px);
}

.nav-container {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:1.5rem;
  max-width:1600px;
  margin:0 auto;
}

.brand{display:flex; flex-direction:column; gap:.1rem;}

.logo {
  font-size: clamp(1.25rem, 1.1rem + .5vw, 1.7rem);
  font-weight:700;
  margin:0;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:transparent;
  background:linear-gradient(120deg, #fff 0%, rgba(178,205,255,.9) 50%, rgba(112,159,255,.85) 100%);
  -webkit-background-clip:text;
  background-clip:text;
  text-shadow:0 10px 30px rgba(29,57,120,.45);
}

.logo-sub{
  margin:0;
  font-size:.82rem;
  letter-spacing:.36em;
  text-transform:uppercase;
  color:rgba(170,188,224,.7);
  font-weight:600;
}

.main-nav {
  display:flex;
  gap:.65rem;
  flex-wrap:wrap;
  align-items:center;
  justify-content:flex-end;
}

.nav-link {
  position:relative;
  display:inline-flex;
  align-items:center;
  gap:.45rem;
  padding:.5rem 1.05rem;
  border-radius:999px;
  background:rgba(21,30,47,.8);
  color:var(--text);
  font-weight:600;
  border:1px solid transparent;
  box-shadow:0 16px 30px -28px rgba(51,102,204,.85);
  transition:background .18s ease, color .18s ease, transform .18s ease, border-color .18s ease, box-shadow .18s ease;
}

.nav-link::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  border:1px solid rgba(117,151,212,.15);
  pointer-events:none;
  transition:opacity .2s ease;
  opacity:.7;
}

.nav-link:hover,
.nav-link:focus-visible{
  background:rgba(45,74,130,.9);
  color:#fff;
  transform:translateY(-1px);
  border-color:rgba(125,165,238,.45);
  box-shadow:0 22px 34px -26px rgba(70,128,255,.75);
}

.nav-link.active{
  background:linear-gradient(135deg, rgba(61,125,255,.95), rgba(102,155,255,.75));
  border-color:rgba(116,162,255,.9);
  color:#fff;
  box-shadow:0 28px 36px -26px rgba(61,125,255,.72);
}

.nav-link.active::after{opacity:0;}

.nav-link:focus-visible{
  outline:2px solid rgba(111,155,255,.8);
  outline-offset:3px;
}

@media (max-width: 900px){
  .nav-container{flex-direction:column; align-items:flex-start;}
  .brand{align-items:flex-start;}
  .main-nav{width:100%; justify-content:flex-start;}
  .nav-link{padding:.45rem .9rem;}
}

/* ==============================
   Flash Messages
   ============================== */
.flashes {
  list-style:none;
  margin:0 0 1.25rem;
  padding:0;
  display:grid;
  gap:.65rem;
}

.flash {
  margin:0;
  padding:.65rem 1rem;
  border-radius:var(--radius-md);
  font-size:.9rem;
  font-weight:600;
  background:rgba(19,28,45,.85);
  color:var(--text);
  border:1px solid rgba(122,150,205,.35);
  box-shadow:0 18px 38px -30px rgba(28,45,79,.85);
  backdrop-filter:blur(14px);
}

.flash.ok {
  background:rgba(39,174,96,.12);
  color:#8df3b9;
  border-color:rgba(39,174,96,.55);
}

.flash.error {
  background:rgba(231,76,60,.16);
  color:#ffc4ba;
  border-color:rgba(231,76,60,.55);
}

/* ==============================
   Tables / Roster Layout
   ============================== */
table{
  border-collapse:collapse;
  width:100%;
  margin-bottom:0;
  font-size:.82rem;
  background:var(--card);
  color:var(--text);
  border:1px solid rgba(108,129,168,.28);
  border-radius:var(--radius-md);
  box-shadow:var(--shadow-soft);
}

thead th{
  background:linear-gradient(135deg, rgba(35,51,85,.9), rgba(23,33,54,.9));
  color:#fff;
  text-transform:uppercase;
  letter-spacing:.05em;
  font-size:.78rem;
}

tbody tr{transition:background .2s ease, transform .2s ease;}

tbody tr:hover{background:rgba(84,118,192,.12);}

.legend { margin-top:.35rem; color:var(--text-muted); }

th,td{border:1px solid var(--line); text-align:center; padding:.25rem .35rem}

th.sticky{position:sticky; top:0; background:var(--head); color:#fff; z-index:2}
th.sticky.left{left:0; z-index:3; background:var(--head)}
.roster th.dayhead{font-weight:bold; background:var(--head2); color:#fff}

/* small weekday label under day number */
.roster th.dayhead .dow{font-size:0.7rem; font-weight:normal; opacity:0.85}

/* weekend header highlight */
.roster th.weekend{
  background:#555 !important;
  color:#ffeb3b !important;
}

.roster td.left{text-align:left; white-space:nowrap}
.roster tr.watch-break td{border-bottom:3px solid #888}

/* Left columns */
.col-name{min-width:140px; max-width:180px}
.col-staff{width:60px}
.col-date{width:68px}
.col-watch{width:40px; text-align:center}

/* Day cells */
.roster .cell{
  position: relative;
  overflow: hidden;
  min-width:54px; max-width:64px;
  padding:0;
}
.roster .cell form{ margin:0 }

/* Request badge */
.req-badge{
  display:inline-block; font-size:10px; padding:2px 6px; border-radius:999px;
  border:1px solid rgba(132,155,210,.35); background:rgba(97,135,210,.18);
  color:#d8e5ff;
  font-weight:600;
  letter-spacing:.04em;
}

/* Make both stacked selects align perfectly */
.roster .cell .code-input,
.roster .cell .annot-select{
  display:block;
  width:100%;
  box-sizing:border-box;
  margin:0;
  border-radius:0;
  padding:.1rem .2rem;
  border:1px solid transparent;
}

/* Disabled state */
.roster .cell select:disabled{
  opacity:.65;
  filter:grayscale(35%);
  cursor:not-allowed;
}

/* ==============================
   Shift Dropdowns (codes)
   ============================== */
.code-input{
  height:28px;
  border:none;
  font-family:var(--font-mono);
  font-size:.9rem;
  line-height:1;
  text-align:center;
  text-transform:uppercase;
  letter-spacing:.02em;

  background:rgba(18,24,40,.9);
  color:#f0f0f0;

  -webkit-appearance:none;
  -moz-appearance:none;
  appearance:none;
}
.code-input option{ font-size:.92rem; text-transform:uppercase; }

/* Group colours by first letter */
.code-input.group-m{ background:var(--green); color:#000 }
.code-input.group-d{ background:var(--purple); color:#fff }
.code-input.group-a{ background:var(--orange); color:#000 }
.code-input.group-n{ background:var(--yellow); color:#000 }

/* Specific overrides */
.code-input.ssc, .code-input.sc{ background:var(--red); color:#fff }

/* Keep AL/PL/SPL blue (and TOUI/TOU8) */
.code-input.al, .code-input.pl, .code-input.spl,
.code-input.toui, .code-input.tou8{
  background:var(--blue) !important; color:#fff !important;
}

/* ==============================
   Annotation dropdown (2nd line)
   ============================== */
.annot-select{
  height:20px;
  margin-top:1px;
  font-size:.72rem;
  text-align:center;
  background:#262626;
  color:#ddd;
  -webkit-appearance:none;
  -moz-appearance:none;
  appearance:none;
  border-color:transparent;
}
.annot-select.has-annotation{
  background:#ffeb3b !important;
  color:#000 !important;
  font-weight:800;
  border-color:#f1c40f;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset, 0 0 8px rgba(255,235,59,.55);
}
.annot-select.has-annotation option{ background:#111; color:#fff; }

/* ==============================
   RAG Counters + Totals
   ============================== */
tfoot td{background:var(--card); font-weight:bold; color:var(--text)}
.totcell{font-size:.7rem; line-height:1.2}
.rag.green{color:#2ecc71}
.rag.amber{color:#f1c40f}
.rag.red{color:#e74c3c}

/* OT totals highlight helpers (apply to cells/spans) */
.ot-green{ background:#1b5e20 !important; color:#fff !important; font-weight:700; }
.ot-amber{ background:#f9a825 !important; color:#000 !important; font-weight:700; }
.ot-red{ background:#c62828 !important; color:#fff !important; font-weight:700; }

/* ==============================
   Fatigue (screen only)
   ============================== */
.cell.fatigue{
  background:#ff2b2b !important;
  border-color:#ff2b2b !important;
  box-shadow: 0 0 0 2px #ff2b2b inset,
              0 0 8px rgba(255, 43, 43, 0.9),
              0 0 16px rgba(255, 43, 43, 0.6);
  animation: fatigue-pulse 1.5s ease-in-out infinite;
}
.cell.fatigue .code-input{
  background: transparent !important;
  color:#fff !important;
  font-weight:700;
  text-shadow:0 1px 1px rgba(0,0,0,.4);
  outline:none;
  border:none;
}
.cell.fatigue .code-input option{ background:#222; color:#fff; }
.cell.fatigue::after{
  content:"⚠️"; position:absolute; top:-6px; right:-6px; font-size:.9rem;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,.5));
}
.cell.fatigue::before{
  content:""; position:absolute; inset:-1px; border:2px solid #ff2b2b; border-radius:2px; pointer-events:none;
}
@keyframes fatigue-pulse{
  0%{   box-shadow: 0 0 0 2px #ff2b2b inset, 0 0 8px rgba(255,43,43,.9), 0 0 16px rgba(255,43,43,.6); }
  50%{  box-shadow: 0 0 0 2px #ff2b2b inset, 0 0 14px rgba(255,43,43,1),  0 0 26px rgba(255,43,43,.9); }
  100%{ box-shadow: 0 0 0 2px #ff2b2b inset, 0 0 8px rgba(255,43,43,.9),  0 0 16px rgba(255,43,43,.6); }
}

/* ==============================
   Admin Cards
   ============================== */
.card{
  background:linear-gradient(145deg, rgba(29,41,66,.88), rgba(17,26,44,.88));
  border:1px solid rgba(110,138,190,.25);
  border-radius:var(--radius-lg);
  padding:1.4rem 1.6rem;
  margin-bottom:1.8rem;
  box-shadow:var(--shadow-pop);
  backdrop-filter:blur(16px);
}

.card h3{margin-top:0; color:#fff}
.row{display:flex; flex-wrap:wrap; gap:.5rem; align-items:center}
.row label{font-size:.8rem; color:#ddd}
.mini th,.mini td{padding:.2rem .4rem}

/* ==============================
   Expiry warnings
   ============================== */
.exp-green { background:#2e7d32; color:#fff; font-weight:700; }
.exp-amber { background:#f9a825; color:#000; font-weight:700; }
.exp-red { background:#e53935; color:#fff; font-weight:700; }
.exp-orange { background:#ff9800; color:#000; font-weight:700; }

/* ==============================
   Metrics heat rules
   ============================== */
.tr-warn { background:#ffb74d !important; color:#000 !important; }
.tr-danger { background:#ef5350 !important; color:#fff !important; }

/* Badges */
.badge{ display:inline-block; padding:.15rem .45rem; border-radius:999px; margin-left:.35rem; font-size:.72rem; line-height:1; font-weight:600; letter-spacing:.03em; }
.badge-soal{ background:#3498db; color:#fff; }
/* U/T flag in orange fill */
.badge-ut, .ut-flag{ background:#ff9800; color:#000; font-weight:700; padding:.05rem .35rem; border-radius:4px; }

/* ==============================
   Calendar subscribe spacing
   ============================== */
.cal-subscribe{
  display:flex;
  flex-direction:column;
  gap:1rem;
}
.cal-subscribe .cal-row{
  display:flex;
  gap:0.9rem;
  align-items:center;
  flex-wrap:wrap;
  margin-bottom:0.25rem;
}
.cal-link{
  display:inline-block;
  margin-right:.6rem;
  padding:.3rem .55rem;
}

/* ==============================
   Responsive + Dynamic scaling
   ============================== */
table.roster { transform-origin: top left; transform: scale(var(--ui-scale)); }
.roster .cell .code-input { font-size: calc(.9rem * var(--ui-scale)); height: calc(28px * var(--ui-scale)); }
.roster .cell .annot-select { font-size: calc(.72rem * var(--ui-scale)); height: calc(20px * var(--ui-scale)); }
th, td { font-size: calc(.82rem * var(--ui-scale)); }

/* ==============================
   Today column highlight (screen)
   ============================== */
.roster th.dayhead.is-today {
  outline: 2px solid rgba(0,0,0,.15);
  background: rgba(255,255,0,.10) !important;
}
.roster td.cell.is-today {
  outline: 2px solid rgba(0,0,0,.15);
  background: rgba(255,255,0,.08) !important;
}
/* Optional: visual overlay line if you inject a .today-col-outline element */
.today-col-outline{
  position:absolute; top:0; bottom:0; width:2px; background:#ffeb3b;
  pointer-events:none; z-index:5; opacity:.6;
}

/* ==============================
   PRINT STYLES
   ============================== */
@media print{
  /* Page & colours */
  html, body{
    background:#fff !important;
    color:#000 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  @page{
    size: A4 landscape;
    margin:6mm;             /* a bit smaller to use more width */
  }

  /* Hide chrome */
  .site-header, .flashes, .month-nav, .main-nav, .btn, a.nav-link { display:none !important; }

  /* Table fills the page width */
  table{
    width:100% !important;
    table-layout: fixed !important;      /* even column widths */
    border-collapse:collapse !important;
    background:#fff !important; color:#000 !important;
    border-color:#000 !important;
    font-size:0.74rem;                    /* slightly larger for readability */
    transform:none !important;
  }
  thead{ display:table-header-group; }
  tfoot{ display:table-footer-group; }
  th.sticky{ position:static !important; top:auto !important; }

  /* All cells: white with strong black grid */
  th, td{
    background:#fff !important;
    border:1px solid #000 !important;
    color:#000 !important;
  }
  .roster th.weekend{ background:#fff !important; color:#000 !important; }
  tfoot td{ background:#fff !important; }

  /* Keep grid alignment: collapse (don't remove) these columns */
  th.col-staff, td.col-staff,
  th.col-date,  td.col-date{
    visibility:hidden !important;       /* stays in the column model */
    width:0 !important;
    min-width:0 !important;
    max-width:0 !important;
    padding:0 !important;
    border-left:none !important;
    border-right:none !important;
  }

  /* Name & Watch tuned sizes */
  th.col-name, td.col-name{
    width:120px !important;
    min-width:120px !important;
    max-width:140px !important;
    white-space:normal !important;
    overflow:visible !important;
    text-align:left !important;
    font-weight:600;
  }
  th.col-watch, td.col-watch{
    width:26px !important;
    min-width:26px !important;
    max-width:28px !important;
  }

  /* Day cells: let them expand to fill remaining space evenly */
  .roster .cell{
    width:auto !important;
    min-width:0 !important;              /* override screen min 54px */
    max-width:none !important;
    padding:0 !important;
  }

  /* Footer readability */
  .totcell{ font-size:.68rem !important; line-height:1.15 !important; }

  /* Remove fatigue glow + today highlight (keep the column visible) */
  *{ animation:none !important; box-shadow:none !important; }
  .cell.fatigue{ background:inherit !important; border-color:inherit !important; }
  .cell.fatigue::before, .cell.fatigue::after{ display:none !important; }
  .roster th.dayhead.is-today,
  .roster td.cell.is-today{ outline:none !important; background:transparent !important; }
  .today-col-outline{ display:none !important; }

  /* Keep coloured shift backgrounds */
  select.code-input{ color:#000 !important; }
  .code-input.group-m{ background: var(--green) !important; color:#000 !important; }
  .code-input.group-d{ background: var(--purple) !important; color:#fff !important; }
  .code-input.group-a{ background: var(--orange) !important; color:#000 !important; }
  .code-input.group-n{ background: var(--yellow) !important; color:#000 !important; }
  .code-input.al, .code-input.pl, .code-input.spl,
  .code-input.toui, .code-input.tou8{ background: var(--blue) !important; color:#000 !important; }
  .code-input.sc, .code-input.ssc{ background: var(--red) !important; color:#000 !important; }

  /* Clean select rendering while keeping backgrounds */
  select{
    appearance:none !important;
    -webkit-appearance:none !important;
    border:none !important;
    padding:0 !important;
    color:#000 !important;
    background:transparent !important;
  }

  /* Avoid splitting a staff row across pages */
  .roster tr{ page-break-inside: avoid; }
}



/* ==============================
   Page margins for print (fallback)
   ============================== */
@page{
  size: A4 landscape;
  margin:8mm;
}


/* EM uses Morning colour */
.code-input.em { background: var(--yellow); color: #000; }
.code-input.group-e { background: var(--yellow); color: #000; }

.chip.ot-flag-sick{ background:#f9a825; color:#000; font-weight:700; }
